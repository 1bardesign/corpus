<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>corpus: tiny compression for browsers and scripts</title>
	<script type="text/javascript" src="corpus_compress.js"></script>
	<script type="text/javascript" src="corpus_default_dicts.js"></script>
	<script type="text/javascript">
		function comp_to_rep(s)
		{
			var out = [];
			for (var i = 0; i < s.length; i++)
			{
				var b = s.charCodeAt(i);
				if (b == 0)
				{
					out.push("0");
				}
				else if(b == 1)
				{
					var b = ["b", JSON.stringify(s.charAt(++i))];
					out.push(b.join(" "));
				}
				else if(b == 2)
				{
					var b = [];
					b.push("st");
					var count = s.charCodeAt(++i);
					b.push(count);
					b.push(JSON.stringify(s.substr(i+1, count)))
					i += count;
					out.push(b.join(" "));
				}
				else
				{
					out.push("d");
				}
			}
			return "["+out.join("] [")+"]";
		}

		function init()
		{
			document.getElementById("input")
				.addEventListener("submit", function (event)
			{
				event.preventDefault();

				var form = document.getElementsByName("send")[0];
				var con = document.getElementById("output");

				var compression_dict = default_dicts.smaz;

				var input = form.value;
				var compressed = compress(input, compression_dict);
				var decompressed = decompress(compressed, compression_dict);
				con.innerHTML = [
					["<p>", "length:", input.length, JSON.stringify(input), "</p>"].join(" "),
					["<p>", "length:", compressed.length, comp_to_rep(compressed), "</p>"].join(" "),
					["<p>", JSON.stringify(compressed), "</p>"].join(" "),
					["<p>", (input == decompressed ?
						"compressed size: "+ Math.round((compressed.length / decompressed.length) * 100)+"%" :
						"(failed round-trip: "+JSON.stringify(decompressed)+")"),
					"</p>"].join(" ")
					].join("\n\n")

				form.value = "";
			});
		}

		window.onload = init;
	</script>
	<style type="text/css">
		body {
			font-family: monospace;
			background: grey;
		}
		input {
			width: 800px;
		}
		#container {
			background: white;
			width: 860px;
			padding: 30px;
			margin: auto;
			margin-top: 10px;
		}
	</style>
</head>
<body>
<div id="container">
<form id="input"><input type="textfield" name="send"/></form>
<p id="output"></p>
</div>
</body>
</html>
